10 ' GET5BITS.BAS
20 DIM BT(15):FOR BT=0 TO 14:BT(BT)=INT(2^BT):NEXT:BT(15)=-32768
30 BW=0
40 GOSUB 90:IF B=-1 THEN END
50 Z=B:PRINT"BYTE ";:GOSUB 500:PRINT
60 IF INKEY$="" THEN 60
70 GOTO 40
80 END

90 '
100 ' GET 5-BITS
110 '
120 ' B1 - BYTE 1
130 ' B2 - BTYE 2
140 ' W - WORD (B1B2)
150 ' BW - BITS WAITING
160 ' B - BYTE TO RETURN
170 '
180 ' IF 8+ BITS WAITING, SKIP
190 IF BW>8 THEN 260
200 READ B2:IF B2=-1 THEN B=-1:RETURN
210 W=B1*256+B2*(2^(8-BW)):BW=BW+8
220 PRINT"  ";:Z=W:GOSUB 430:PRINT BW
230 B1=INT(W/256)
240 GOTO 190
250 ' THIS WOULD BE SO EASY IF AND WORKED WITH >&H7FFF.
260 ' BYTE WILL BE LEFT 5 BITS OF W
270 ' B = W SHIFTED RIGHT 11 BITS, ANDED WITH 11111
280 B=INT(W/2048) AND &H1F
290 ' SHIFT W LEFT 5 BITS, DROPPING HIGHER BITS:
300 ' B1 IS W SHIFTED RIGHT 8 BITS, ANDED WITH 111
310 ' TO GIVE US
320 B1=INT(W/256) AND &H07
330 ' B2 IS W - (W SHIFTED RIGHT 8 BITS) * 256
340 B2=W-INT(W/256)*256
350 ' W = B1B2
360 W=B1*256+B2
370 ' SHIFT W LEFT 5 BITS. BITS WAITING 5 LESS.
380 W=W*32:BW=BW-5
390 ' GET NEW B1 AND B2
400 B1=INT(W/256)
410 B2=W-INT(W/256)*256
420 RETURN
430 REM SHOW 16-BIT Z AS BINARY
440 IF Z>32767 THEN Z2=Z-65536 ELSE Z2=Z
450 FOR BT=15 TO 0 STEP-1
460 IF 16-BT>BW THEN PRINT "-";:GOTO 480
470 IF Z2 AND BT(BT) THEN PRINT "1"; ELSE PRINT "0";
480 NEXT
490 RETURN
500 REM SHOW 8-BIT Z AS BINARY
510 FOR BT=7 TO 0 STEP-1
520 IF Z AND BT(BT) THEN PRINT "1"; ELSE PRINT "0";
530 NEXT
540 RETURN
550 ' 8 5-bit values:
560 ' 11111 00000 11111 00000 11111 0000 11111 00000
570 '
580 '  Byte 1   Byte 2   Byte 3   Byte 4   Byte 5
590 ' -------- -------- -------- -------- --------
600 ' 11111000 00111110 00001111 10000011 11100000
610 DATA &HF8, &H3E,    &H0F,     &H83,    &HE0
620 DATA -1
5001 ' 11111 00000 11111 00000 11111 0000 11111 00000
5002 '
5003 '  Byte 1   Byte 2   Byte 3   Byte 4   Byte 5
5004 ' -------- -------- -------- -------- --------
5005 ' 11111000 00111110 00001111 10000011 11100000
5010 DATA &HF8, &H3E,    &H0F,     &H83,    &HE0
5020 DATA -1
