0 'LN$() LIFO RING BUFFER
1 ' LS=MSG DB LINES
2 ' ST=FIRST LINE USED
3 ' EN=LAST LINE USED+1
4 ' LS=MAX MSG LINE SIZE
5 ' MM=MAX MSG LINES
6 '
7 '
8 'UL$(),UM-MAX,US-SIZE
9 '
10 CLEAR 12*32+249
20 LM=12:LS=32:MM=10
25 MF=(LM+1)*LS
30 DIM LN$(LM):ST=-1:EN=0
100 '
101 ' MAIN MENU
102 '
104 FOR A=0 TO LM:PRINT A;LN$(A):NEXT:PRINT ST;EN;MF
105 PRINT "P-OST, R-EAD, S-CAN: ";
110 A$=INKEY$:IF A$="" THEN 110
115 A=INSTR("*PRS",A$):IF A=0 THEN 110
120 ON A GOSUB 200,300,400
125 GOTO 100
200 '
201 ' POST
202 '
205 PRINT "POST"
210 PRINT"SUBJECT:";:SZ=32:GOSUB 1000:IF A$="" THEN RETURN ELSE SB$=A$
215 PRINT "Enter up to";MM;"lines,";LS;"chars. [ENTER] on a blank line to end.":A=0
220 PRINT USING"##>";A+1;:GOSUB 1000:IF A$="" THEN 270
221 ' SPECIAL CASE FOR FIRST LINE: We have to check the start slot for the
222 ' header, then the next slot for the message. After this, we can just
223 ' check the current slot as new lines are typed.
225 IF A=0 THEN Z=EN:GOSUB 500
230 A=A+1:B=EN+A:IF B>LM THEN B=B-LM-1
235 Z=B:GOSUB 500
250 LN$(B)=A$:MF=MF-LEN(A$):IF A<MM THEN 220
265 '
266 ' SAVE
267 '
270 IF A=0 THEN PRINT "ABORTED":GOTO 295
275 LN$(EN)=CHR$(&H80+A)+"FT"+SB$:MF=MF-LEN(LN$(EN))
280 IF ST<0 THEN ST=EN
285 PRINT "SAVED";A;"LINES FROM";EN;"TO";B
290 EN=B+1:IF EN>LM THEN EN=EN-LM-1
295 RETURN
300 '
301 ' READ
320 '
305 PRINT "READ"
310 IF ST<0 THEN PRINT "NO MESSAGES":RETURN
395 RETURN
400 '
401 ' SCAN
402 '
405 PRINT "SCAN"
410 IF ST<0 THEN PRINT "NO MESSAGES":RETURN
495 RETURN
500 '
501 ' DELETE LINES IF NEEDED
502 '
505 IF Z<>ST THEN RETURN
510 PRINT"ERASING LINE";ST:MF=MF+LEN(LN$(ST)):LN$(ST)=""
515 ST=ST+1:IF ST>LM THEN ST=0
520 IF LN$(ST)<>"" THEN IF ASC(LEFT$(LN$(ST),1))<&H80 THEN 510
525 RETURN
999 END
1000 '
1001 ' LINE INPUT
1002 ' IN: SZ=MAX SIZE
1003 ' OUT: A$=RETURNED STRING
1004 '
1010 LINE INPUT A$:A$=LEFT$(A$,SZ):RETURN
5000 '
5001 ' STRING SPACE FREE
5002 '
5010 Z=(PEEK(&H23)*256+PEEK(&H24))-(PEEK(&H21)*256+PEEK(&H22)):RETURN
